import streamlit as st
import pandas as pd

# è¨­å®šç¶²é æ¨™é¡Œèˆ‡é¢¨æ ¼
st.set_page_config(page_title="114å¹´æ¨¡è€ƒç­‰ç´šé æ¸¬ç³»çµ±", layout="centered")

st.title("ğŸ¯ 114å¹´æœƒè€ƒæ¨¡æ“¬è€ƒç­‰ç´šé æ¸¬ç³»çµ±")
st.markdown("---")

# 1. å»ºç«‹æ ¸å¿ƒæ•¸æ“šæ¨¡å‹
def get_model():
    return {
        'åœ‹æ–‡': {
            'åæ˜“': {'A++': 40, 'A+': 38, 'A': 36, 'B++': 32, 'B+': 28, 'B': 17, 'C': 0},
            'æ­£å¸¸': {'A++': 39, 'A+': 37, 'A': 35, 'B++': 31, 'B+': 27, 'B': 17, 'C': 0},
            'åé›£': {'A++': 38, 'A+': 36, 'A': 33, 'B++': 29, 'B+': 25, 'B': 17, 'C': 0},
            'æ¥µé›£': {'A++': 37, 'A+': 35, 'A': 32, 'B++': 29, 'B+': 25, 'B': 16, 'C': 0}
        },
        'æ•¸å­¸': {
            'åæ˜“': {'A++': 93.2, 'A+': 87.3, 'A': 77.1, 'B++': 66.9, 'B+': 55.1, 'B': 36.5, 'C': 0},
            'æ­£å¸¸': {'A++': 92.5, 'A+': 86.4, 'A': 76.2, 'B++': 66.2, 'B+': 55.1, 'B': 38.8, 'C': 0},
            'åé›£': {'A++': 91.6, 'A+': 85.7, 'A': 74.6, 'B++': 63.7, 'B+': 52.6, 'B': 32.0, 'C': 0},
            'æ¥µé›£': {'A++': 90.7, 'A+': 84.8, 'A': 75.5, 'B++': 67.1, 'B+': 57.8, 'B': 37.4, 'C': 0}
        },
        'è‹±èª': {
            'åæ˜“': {'A++': 98.14, 'A+': 96.28, 'A': 91.5, 'B++': 85.0, 'B+': 75.0, 'B': 45.0, 'C': 0},
            'æ­£å¸¸': {'A++': 98.14, 'A+': 96.23, 'A': 90.7, 'B++': 83.26, 'B+': 73.91, 'B': 44.05, 'C': 0},
            'åé›£': {'A++': 96.28, 'A+': 94.42, 'A': 89.0, 'B++': 81.0, 'B+': 71.0, 'B': 42.0, 'C': 0},
            'æ¥µé›£': {'A++': 95.33, 'A+': 91.61, 'A': 85.12, 'B++': 75.81, 'B+': 64.65, 'B': 41.24, 'C': 0}
        },
        'ç¤¾æœƒ': {
            'åæ˜“': {'A++': 52, 'A+': 51, 'A': 48, 'B++': 41, 'B+': 35, 'B': 22, 'C': 0},
            'æ­£å¸¸': {'A++': 52, 'A+': 51, 'A': 47, 'B++': 40, 'B+': 33, 'B': 21, 'C': 0},
            'åé›£': {'A++': 51, 'A+': 50, 'A': 46, 'B++': 38, 'B+': 31, 'B': 18, 'C': 0},
            'æ¥µé›£': {'A++': 51, 'A+': 49, 'A': 45, 'B++': 38, 'B+': 31, 'B': 18, 'C': 0}
        },
        'è‡ªç„¶': {
            'åæ˜“': {'A++': 48, 'A+': 47, 'A': 44, 'B++': 36, 'B+': 28, 'B': 17, 'C': 0},
            'æ­£å¸¸': {'A++': 48, 'A+': 47, 'A': 43, 'B++': 36, 'B+': 28, 'B': 19, 'C': 0},
            'åé›£': {'A++': 47, 'A+': 45, 'A': 42, 'B++': 35, 'B+': 28, 'B': 19, 'C': 0},
            'æ¥µé›£': {'A++': 46, 'A+': 45, 'A': 41, 'B++': 34, 'B+': 28, 'B': 19, 'C': 0}
        }
    }

# 2. å´é‚Šæ¬„ï¼šè¼¸å…¥å€
st.sidebar.header("ğŸ“‹ è¼¸å…¥æ‚¨çš„æˆç¸¾")
subject = st.sidebar.selectbox("é¸æ“‡ç§‘ç›®", ['åœ‹æ–‡', 'æ•¸å­¸', 'è‹±èª', 'ç¤¾æœƒ', 'è‡ªç„¶'])
difficulty = st.sidebar.selectbox("è€ƒå·é›£åº¦", ['åæ˜“', 'æ­£å¸¸', 'åé›£', 'æ¥µé›£'])

# é‡å°æ•¸å­¸èˆ‡è‹±æ–‡æä¾›åŠ æ¬Šè¨ˆç®—å™¨
if subject in ['æ•¸å­¸', 'è‹±èª']:
    st.sidebar.info(f"{subject}ç§‘è«‹è¼¸å…¥åŠ æ¬Šå¾Œçš„åˆ†æ•¸ï¼Œæˆ–ä½¿ç”¨ä¸‹æ–¹å°å·¥å…·è¨ˆç®—")
    if subject == 'æ•¸å­¸':
        c_r = st.sidebar.number_input("é¸æ“‡é¡Œç­”å°æ•¸", 0, 25, 25)
        n_r = st.sidebar.number_input("éé¸æ“‡é¡Œå¾—åˆ†", 0, 6, 6)
        score = (c_r/25)*85 + (n_r/6)*15
    else:
        r_r = st.sidebar.number_input("é–±è®€ç­”å°æ•¸", 0, 41, 41)
        l_r = st.sidebar.number_input("è½åŠ›ç­”å°æ•¸", 0, 21, 21)
        score = (r_r/41)*80 + (l_r/21)*20
else:
    score = st.sidebar.number_input("ç­”å°é¡Œæ•¸", 0, 63, 40)

# 3. åˆ¤å®šé‚è¼¯
model = get_model()
thresholds = model[subject][difficulty]
result = "C"
for grade in ['A++', 'A+', 'A', 'B++', 'B+', 'B', 'C']:
    if score >= thresholds[grade]:
        result = grade
        break

# 4. ç¶²é ä¸»ç•«é¢é¡¯ç¤º
col1, col2 = st.columns(2)
col1.metric("ç•¶å‰è¼¸å…¥åˆ†æ•¸", f"{score:.2f}")
col2.metric("é æ¸¬ç­‰ç´š", result)

st.subheader(f"ğŸ“Š {subject} ({difficulty}) ç´šè·å°ç…§è¡¨")
df = pd.DataFrame(model[subject]).T
st.table(df[['A++', 'A+', 'A', 'B++', 'B+', 'B']])

st.success("æœ¬æ•¸æ“šåš´æ ¼åƒè€ƒå—ä¸€ã€ç¿°æ—æ¨¡è€ƒç´šè·èˆ‡114å¹´åƒæ•¸ä¿®æ­£ã€‚")
